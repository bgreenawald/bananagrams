!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return m})),n.d(t,"j",(function(){return p})),n.d(t,"i",(function(){return y})),n.d(t,"m",(function(){return g})),n.d(t,"n",(function(){return b})),n.d(t,"k",(function(){return o})),n.d(t,"l",(function(){return a}));let r=[],o=!1;const l=document.querySelector(".menu"),a=!1;var c=function(e){e.preventDefault();var t=e.target.classList;t.contains("selected")?t.remove("selected"):t.add("selected")},u=function(e){e.target.style.opacity=.4,e.target.classList.contains("selected")||e.target.classList.add("selected"),e.target.style.cursor="grabbing",e.dataTransfer.dropEffect="copy",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text",e.target.dataset.tileId)},d=function(e){e.target.style.opacity=""},i=function(e){e.preventDefault(),e.target.classList.contains("selected")&&e.target.classList.remove("selected"),e.target.classList.contains("swap")?(l.setAttribute("active-tile-id",null),e.target.classList.remove("swap")):(l.setAttribute("active-tile-id",e.target.getAttribute("data-tile-id")),e.target.classList.add("swap"))},s=function(e){e.preventDefault(),0===e.target.children.length&&e.target.classList.add("over")},f=function(e){e.preventDefault(),e.target.classList.contains("over")&&e.target.classList.remove("over")},m=function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1},p=function(e){return e.preventDefault&&e.preventDefault(),!1},v=null,y=function(e){e.preventDefault();var t=e.target;if(null!==(v=e.dataTransfer.getData("text"))&&""!==v.trim()){var n=document.querySelector('.tile[data-tile-id="'+v+'"]'),o=n.parentElement.dataset.row,l=n.parentElement.dataset.column,a=t.dataset.row,c=t.dataset.column,u=Number(a)-Number(o),d=Number(c)-Number(l),i=null,s=Array.from(document.querySelectorAll(".selected"));for(r=s.map((function(e){return{id:e.dataset.tileId,row:e.parentElement.dataset.row,column:e.parentElement.dataset.column}}));i!=r.length;){i=r.length;for(var f=0;f<i;f+=1){var m=r.shift(),p=document.querySelector('.tile[data-tile-id="'+m.id+'"]');o=p.parentElement.dataset.row,l=p.parentElement.dataset.column,a=u+Number(o),c=d+Number(l);var y=document.querySelector('#board .cell[data-row="'+a+'"][data-column="'+c+'"]');y.children.length>0?r.push(m):(y.appendChild(p),t.classList.remove("over"),t.classList.add("filled"),p.dataset.row=a,p.dataset.column=c)}}r=[],h(),g("tile")}else t.classList.contains("over")&&t.classList.remove("over")},g=function(e){Array.from(document.querySelectorAll("."+e)).forEach((function(e){e.classList.remove("selected"),e.style.opacity=""}))},h=function(){var e=document.querySelector("#bench"),t=[];Array.prototype.forEach.call(e.children,(function(e,n){0==e.children.length&&t.push(e)})),Array.prototype.forEach.call(t,(function(t,n){e.removeChild(t)})),Array.from(e.children).forEach((function(e,t){e.dataset.column=t.toString()}))},b=function(e){l.style.display="show"===e?"block":"none",o=!o}},function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return r}));const r=35,o=35;var l=function(e){var t=[],n=parseInt(e.getAttribute("data-row")),l=parseInt(e.getAttribute("data-column")),a=document.querySelector("#board");return n>0&&t.push(a.querySelectorAll('.cell[data-row="'+(n-1)+'"][data-column="'+l+'"]')[0]),n<r-1&&t.push(a.querySelectorAll('.cell[data-row="'+(n+1)+'"][data-column="'+l+'"]')[0]),l>0&&t.push(a.querySelectorAll('.cell[data-row="'+n+'"][data-column="'+(l-1)+'"]')[0]),l<o-1&&t.push(a.querySelectorAll('.cell[data-row="'+n+'"][data-column="'+(l+1)+'"]')[0]),t},a=function(){var e=document.querySelector("#board");if(document.getElementById("bench").children.length>0)return!1;var t=[],n=[];for(t.push(e.querySelectorAll(".tile")[0]);t.length>0;){var r=t.pop();n.includes(r)||n.push(r),Array.from(l(r)).forEach((function(e){if(e.children.length>0){var r=e.children[0];n.includes(r)||t.push(r)}}))}return console.log("Seen tiles "+n.length),console.log("All tiles "+e.querySelectorAll(".tile").length),n.length===e.querySelectorAll(".tile").length},c=function(){for(var e=[],t=document.querySelector("#board"),n=0;n<r;n++)for(var l="",a=0;a<o;a++){(c=t.querySelectorAll('.cell[data-row="'+n+'"][data-column="'+a+'"]')[0]).children.length>0?l+=c.children[0].textContent:(l.length>1&&e.push(l),l="")}for(a=0;a<o;a++)for(l="",n=0;n<r;n++){var c;(c=t.querySelectorAll('.cell[data-row="'+n+'"][data-column="'+a+'"]')[0]).children.length>0?l+=c.children[0].textContent:(l.length>1&&e.push(l),l="")}return e},u=function(e,t){for(var n=e.slice(),r=0,o=t;r<o.length;r++){var l=o[r],a=n.indexOf(l);a>-1&&n.splice(a,1)}return n}},function(e,t,n){"use strict";n.r(t),n.d(t,"selectAllTiles",(function(){return l}));var r=n(0),o=n(1);n.d(t,"rows",(function(){return o.e})),n.d(t,"columns",(function(){return o.a}));document.querySelector(".menu");document.addEventListener("drop",(function(){Object(r.m)("tile")}),r.l);var l=function(){var e=document.querySelector("#board");Array.from(document.querySelectorAll(".tile")).forEach((function(t){e.contains(t)&&t.classList.add("selected")}))},a=function(){console.log("Centering");var e=document.getElementById("board-viewport"),t=document.getElementById("board"),n=t.offsetLeft+t.offsetWidth/2,r=t.offsetTop+t.offsetHeight/3;e.scrollLeft=n,e.scrollTop=r};document.getElementById("gameplay").style.display="none",document.getElementById("game-over").style.display="none",window.onbeforeunload=function(){return"Are you sure you want to leave, this will clear your board?"},document.getElementById("player_id").addEventListener("keyup",(function(e){13===e.keyCode&&(e.preventDefault(),$("#player_id_submit").click())})),window.addEventListener("click",(function(e){r.k&&Object(r.n)("hide")})),function(){for(var e=document.getElementById("board"),t=0;t<o.e;t++)for(var n=0;n<o.a;n++)e.innerHTML+='<div class="cell" data-row='+t+" data-column="+n+"></div>";Array.from(document.querySelectorAll(".cell")).forEach((function(e){e.addEventListener("onmousedown",r.j,r.l),e.addEventListener("dragenter",r.e,r.l),e.addEventListener("dragleave",r.f,r.l),e.addEventListener("dragover",r.g,r.l),e.addEventListener("dragend",r.d,r.l),e.addEventListener("drop",r.i,r.l)})),a()}()}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vLi90cy9ldmVudHMudHMiLCJ3ZWJwYWNrOi8vLy4vdHMvaGVscGVycy50cyIsIndlYnBhY2s6Ly8vLi90cy9ib2FyZC50cyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJhIiwiaSIsIndpbmRvdyIsImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsInRpbGVzVG9EcmFnIiwibWVudVZpc2libGUiLCJtZW51IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwib3B0aW9ucyIsImhhbmRsZUNsaWNrIiwiZSIsInByZXZlbnREZWZhdWx0IiwiY2xhc3NlcyIsInRhcmdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiYWRkIiwiaGFuZGxlRHJhZ1N0YXJ0Iiwic3R5bGUiLCJvcGFjaXR5IiwiY3Vyc29yIiwiZGF0YVRyYW5zZmVyIiwiZHJvcEVmZmVjdCIsImVmZmVjdEFsbG93ZWQiLCJzZXREYXRhIiwiZGF0YXNldCIsInRpbGVJZCIsImhhbmRsZURyYWdFbmQiLCJoYW5kbGVEb3VibGVDbGljayIsInNldEF0dHJpYnV0ZSIsImdldEF0dHJpYnV0ZSIsImhhbmRsZURyYWdFbnRlciIsImNoaWxkcmVuIiwibGVuZ3RoIiwiaGFuZGxlRHJhZ0xlYXZlIiwiaGFuZGxlRHJhZ092ZXIiLCJoYW5kbGVPbk1vdXNlRG93biIsImlkIiwiaGFuZGxlRHJvcCIsInByaW1hcnlEZXN0aW5hdGlvbkNlbGwiLCJnZXREYXRhIiwidHJpbSIsInByaW1hcnlUaWxlIiwic291cmNlUm93IiwicGFyZW50RWxlbWVudCIsInJvdyIsInNvdXJjZUNvbHVtbiIsImNvbHVtbiIsImRlc3RpbmF0aW9uUm93IiwiZGVzdGluYXRpb25Db2x1bW4iLCJyb3dDaGFuZ2UiLCJOdW1iZXIiLCJjb2x1bW5DaGFuZ2UiLCJxdWV1ZUxlbmd0aCIsInNlbGVjdGVkVGlsZXMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwibWFwIiwidGlsZSIsInRpbGVEYXRhIiwic2hpZnQiLCJzZWNvbmRhcnlUaWxlIiwic2Vjb25kYXJ5RGVzdGluYXRpb24iLCJwdXNoIiwiYXBwZW5kQ2hpbGQiLCJjbGVhbkJlbmNoIiwicmVzZXRNb2RpZmllcnMiLCJjbGFzc05hbWUiLCJmb3JFYWNoIiwiZWxlbWVudCIsImJlbmNoIiwiZW1wdHlDZWxscyIsImNlbGwiLCJpbmRleCIsInJlbW92ZUNoaWxkIiwiYmVuY2hDZWxsIiwidG9TdHJpbmciLCJ0b2dnbGVNZW51IiwiY29tbWFuZCIsImRpc3BsYXkiLCJyb3dzIiwiY29sdW1ucyIsImdldFRpbGVOZWlnaGJvcnMiLCJuZWlnaGJvcnMiLCJ0aWxlUm93IiwicGFyc2VJbnQiLCJ0aWxlQ29sdW1uIiwiYm9hcmQiLCJpc1ZhbGlkQm9hcmQiLCJnZXRFbGVtZW50QnlJZCIsInByb2Nlc3NUaWxlcyIsInNlZW5UaWxlcyIsImN1clRpbGUiLCJwb3AiLCJpbmNsdWRlcyIsIm5laWdoYm9yIiwiY2hpbGRUaWxlIiwiY29uc29sZSIsImxvZyIsImdldEFsbFdvcmRzIiwiYWxsV29yZHMiLCJjdXJXb3JkIiwiY3VyQ2VsbCIsInRleHRDb250ZW50IiwiZmluZERpZmZlcmVuY2UiLCJiIiwicmV0Iiwic2xpY2UiLCJfaSIsImJfMSIsInZhbCIsImluZGV4T2YiLCJzcGxpY2UiLCJhZGRFdmVudExpc3RlbmVyIiwic2VsZWN0QWxsVGlsZXMiLCJjZW50ZXJCb2FyZCIsImJvYXJkVmlld3BvcnQiLCJzY3JvbGxQb3NpdGlvblgiLCJvZmZzZXRMZWZ0Iiwib2Zmc2V0V2lkdGgiLCJzY3JvbGxQb3NpdGlvblkiLCJvZmZzZXRUb3AiLCJvZmZzZXRIZWlnaHQiLCJzY3JvbGxMZWZ0Iiwic2Nyb2xsVG9wIiwib25iZWZvcmV1bmxvYWQiLCJldmVudCIsImtleUNvZGUiLCIkIiwiY2xpY2siLCJpbm5lckhUTUwiLCJwb3B1bGF0ZUJvYXJkIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUEyQ0EsRUFBTUMsR0FDaEQsR0FBc0IsaUJBQVpDLFNBQTBDLGlCQUFYQyxPQUN4Q0EsT0FBT0QsUUFBVUQsU0FDYixHQUFxQixtQkFBWEcsUUFBeUJBLE9BQU9DLElBQzlDRCxPQUFPLEdBQUlILE9BQ1AsQ0FDSixJQUFJSyxFQUFJTCxJQUNSLElBQUksSUFBSU0sS0FBS0QsR0FBdUIsaUJBQVpKLFFBQXVCQSxRQUFVRixHQUFNTyxHQUFLRCxFQUFFQyxJQVB4RSxDQVNHQyxRQUFRLFdBQ1gsTyxZQ1RFLElBQUlDLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVULFFBR25DLElBQUlDLEVBQVNNLEVBQWlCRSxHQUFZLENBQ3pDSixFQUFHSSxFQUNIQyxHQUFHLEVBQ0hWLFFBQVMsSUFVVixPQU5BVyxFQUFRRixHQUFVRyxLQUFLWCxFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTUSxHQUcvRFAsRUFBT1MsR0FBSSxFQUdKVCxFQUFPRCxRQTBEZixPQXJEQVEsRUFBb0JLLEVBQUlGLEVBR3hCSCxFQUFvQk0sRUFBSVAsRUFHeEJDLEVBQW9CTyxFQUFJLFNBQVNmLEVBQVNnQixFQUFNQyxHQUMzQ1Qs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QUssSUFBSVQsRUFBSSxFQUFHQSxFQUFJLElBQVNBLElBQ3pCaUgsRUFBTTJDLFdBQWEsOEJBQWtDbkosRUFBSSxnQkFBa0JULEVBQUksVUFJdkZnRixNQUFNQyxLQUFLbkQsU0FBU29ELGlCQUFpQixVQUFVWSxTQUFRLFNBQVVJLEdBQzdEQSxFQUFLeUMsaUJBQWlCLGNBQWUsSUFBbUIsS0FDeER6QyxFQUFLeUMsaUJBQWlCLFlBQWEsSUFBaUIsS0FDcER6QyxFQUFLeUMsaUJBQWlCLFlBQWEsSUFBaUIsS0FDcER6QyxFQUFLeUMsaUJBQWlCLFdBQVksSUFBZ0IsS0FDbER6QyxFQUFLeUMsaUJBQWlCLFVBQVcsSUFBZSxLQUNoRHpDLEVBQUt5QyxpQkFBaUIsT0FBUSxJQUFZLFFBRTlDRSxJQTBDSmdCIiwiZmlsZSI6ImJvYXJkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIHtcblx0XHR2YXIgYSA9IGZhY3RvcnkoKTtcblx0XHRmb3IodmFyIGkgaW4gYSkgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyA/IGV4cG9ydHMgOiByb290KVtpXSA9IGFbaV07XG5cdH1cbn0pKHdpbmRvdywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwiLyoqXHJcbiAqIFRoZSBldmVudHMgdGhhdCBoYW5kbGUgdGhlIGludGVyYWN0aXZpdHkgb2YgdGhlIGdhbWUuXHJcbiAqXHJcbiAqL1xyXG5cclxuXHJcbi8vIEdsb2JhbCBhcnJheSB1c2VkIHRvIG1hbmFnZSB0aGUgZHJhZyBhbmQgZHJvcC5cclxubGV0IHRpbGVzVG9EcmFnID0gW107XHJcbmxldCBtZW51VmlzaWJsZSA9IGZhbHNlO1xyXG5jb25zdCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZW51XCIpO1xyXG5jb25zdCBvcHRpb25zID0gZmFsc2U7XHJcblxyXG52YXIgaGFuZGxlQ2xpY2sgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdmFyIGNsYXNzZXMgPSBlLnRhcmdldC5jbGFzc0xpc3Q7XHJcbiAgICBjbGFzc2VzLmNvbnRhaW5zKCdzZWxlY3RlZCcpID8gY2xhc3Nlcy5yZW1vdmUoJ3NlbGVjdGVkJykgOiBjbGFzc2VzLmFkZCgnc2VsZWN0ZWQnKTtcclxufTtcclxuXHJcbnZhciBoYW5kbGVEcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS50YXJnZXQuc3R5bGUub3BhY2l0eSA9IC40O1xyXG4gICAgaWYgKCFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykpIHtcclxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgZS50YXJnZXQuc3R5bGUuY3Vyc29yID0gXCJncmFiYmluZ1wiO1xyXG4gICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IFwiY29weVwiO1xyXG4gICAgZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xyXG4gICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YShcInRleHRcIiwgZS50YXJnZXQuZGF0YXNldC50aWxlSWQpO1xyXG59O1xyXG5cclxudmFyIGhhbmRsZURyYWdFbmQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS50YXJnZXQuc3R5bGUub3BhY2l0eSA9IFwiXCI7XHJcbn07XHJcblxyXG52YXIgaGFuZGxlRG91YmxlQ2xpY2sgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgLy8gQWx3YXlzIHJlbW92ZSBzZWxlY3RlZCBjbGFzcyBvbiBkb3VibGUgY2xpY2tcclxuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJzZWxlY3RlZFwiKSkge1xyXG4gICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUb2dnbGUgdGhlIHNlbGVjdGVkIHN3YXAgbGFiZWxcclxuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJzd2FwXCIpKSB7XHJcbiAgICAgICAgbWVudS5zZXRBdHRyaWJ1dGUoXCJhY3RpdmUtdGlsZS1pZFwiLCBudWxsKTtcclxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKFwic3dhcFwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbWVudS5zZXRBdHRyaWJ1dGUoXCJhY3RpdmUtdGlsZS1pZFwiLCBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXRpbGUtaWRcIikpO1xyXG4gICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJzd2FwXCIpO1xyXG4gICAgfVxyXG59O1xyXG5cclxudmFyIGhhbmRsZURyYWdFbnRlciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBpZiAoZS50YXJnZXQuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmFkZChcIm92ZXJcIik7XHJcbiAgICB9XHJcbn07XHJcblxyXG52YXIgaGFuZGxlRHJhZ0xlYXZlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJvdmVyXCIpKSB7XHJcbiAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZShcIm92ZXJcIik7XHJcbiAgICB9XHJcbn07XHJcblxyXG52YXIgaGFuZGxlRHJhZ092ZXIgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgaWYgKGUucHJldmVudERlZmF1bHQpXHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IFwibW92ZVwiO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59O1xyXG52YXIgaGFuZGxlT25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgaWYgKGUucHJldmVudERlZmF1bHQpXHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59O1xyXG5cclxudmFyIGlkID0gbnVsbDtcclxudmFyIGhhbmRsZURyb3AgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdmFyIHByaW1hcnlEZXN0aW5hdGlvbkNlbGwgPSBlLnRhcmdldDtcclxuICAgIC8vIEdldCB0aGUgdGlsZSBJRCBhbmQgaGFuZGxlIHRoZSBudWxsIGNhc2VcclxuICAgIGlkID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgndGV4dCcpO1xyXG4gICAgaWYgKGlkID09PSBudWxsIHx8IGlkLnRyaW0oKSA9PT0gXCJcIikge1xyXG4gICAgICAgIGlmIChwcmltYXJ5RGVzdGluYXRpb25DZWxsLmNsYXNzTGlzdC5jb250YWlucyhcIm92ZXJcIikpIHtcclxuICAgICAgICAgICAgcHJpbWFyeURlc3RpbmF0aW9uQ2VsbC5jbGFzc0xpc3QucmVtb3ZlKFwib3ZlclwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIHByaW1hcnlUaWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50aWxlW2RhdGEtdGlsZS1pZD1cXFwiXCIgKyBpZCArIFwiXFxcIl1cIik7XHJcbiAgICB2YXIgc291cmNlUm93ID0gcHJpbWFyeVRpbGUucGFyZW50RWxlbWVudC5kYXRhc2V0LnJvdztcclxuICAgIHZhciBzb3VyY2VDb2x1bW4gPSBwcmltYXJ5VGlsZS5wYXJlbnRFbGVtZW50LmRhdGFzZXQuY29sdW1uO1xyXG4gICAgdmFyIGRlc3RpbmF0aW9uUm93ID0gcHJpbWFyeURlc3RpbmF0aW9uQ2VsbC5kYXRhc2V0LnJvdztcclxuICAgIHZhciBkZXN0aW5hdGlvbkNvbHVtbiA9IHByaW1hcnlEZXN0aW5hdGlvbkNlbGwuZGF0YXNldC5jb2x1bW47XHJcbiAgICB2YXIgcm93Q2hhbmdlID0gTnVtYmVyKGRlc3RpbmF0aW9uUm93KSAtIE51bWJlcihzb3VyY2VSb3cpO1xyXG4gICAgdmFyIGNvbHVtbkNoYW5nZSA9IE51bWJlcihkZXN0aW5hdGlvbkNvbHVtbikgLSBOdW1iZXIoc291cmNlQ29sdW1uKTtcclxuICAgIHZhciBxdWV1ZUxlbmd0aCA9IG51bGw7XHJcblxyXG4gICAgdmFyIHNlbGVjdGVkVGlsZXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWxlY3RlZCcpKTtcclxuXHJcbiAgICAvLyBjYXNpbmcgb2YgdGlsZUlkIGlzIHNldCBieSBicm93c2VyIHBhcnNpbmdcclxuICAgIHRpbGVzVG9EcmFnID0gc2VsZWN0ZWRUaWxlcy5tYXAoZnVuY3Rpb24gKHRpbGUpIHtcclxuICAgICAgICB2YXIgdGlsZURhdGEgPSB7XHJcbiAgICAgICAgICAgIGlkOiAodGlsZSBhcyBIVE1MRWxlbWVudCkuZGF0YXNldC50aWxlSWQsXHJcbiAgICAgICAgICAgIHJvdzogdGlsZS5wYXJlbnRFbGVtZW50LmRhdGFzZXQucm93LFxyXG4gICAgICAgICAgICBjb2x1bW46IHRpbGUucGFyZW50RWxlbWVudC5kYXRhc2V0LmNvbHVtblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRpbGVEYXRhO1xyXG4gICAgfSk7XHJcbiAgICAvLyBDb250aW51b3VzbHkgdHJ5IGFuZCBtb3ZlIHRpbGVzIG9uZSBieSBvbmUgdW50aWwgbm8gcHJvZ3Jlc3MgaXMgbWFkZS5cclxuICAgIHdoaWxlIChxdWV1ZUxlbmd0aCAhPSB0aWxlc1RvRHJhZy5sZW5ndGgpIHtcclxuICAgICAgICBxdWV1ZUxlbmd0aCA9IHRpbGVzVG9EcmFnLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXVlTGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgdmFyIHRpbGVEYXRhID0gdGlsZXNUb0RyYWcuc2hpZnQoKTtcclxuICAgICAgICAgICAgdmFyIHNlY29uZGFyeVRpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRpbGVbZGF0YS10aWxlLWlkPVxcXCJcIiArIHRpbGVEYXRhLmlkICsgXCJcXFwiXVwiKTtcclxuICAgICAgICAgICAgc291cmNlUm93ID0gc2Vjb25kYXJ5VGlsZS5wYXJlbnRFbGVtZW50LmRhdGFzZXQucm93O1xyXG4gICAgICAgICAgICBzb3VyY2VDb2x1bW4gPSBzZWNvbmRhcnlUaWxlLnBhcmVudEVsZW1lbnQuZGF0YXNldC5jb2x1bW47XHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uUm93ID0gcm93Q2hhbmdlICsgTnVtYmVyKHNvdXJjZVJvdyk7XHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uQ29sdW1uID0gY29sdW1uQ2hhbmdlICsgTnVtYmVyKHNvdXJjZUNvbHVtbik7XHJcbiAgICAgICAgICAgIHZhciBzZWNvbmRhcnlEZXN0aW5hdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYm9hcmQgLmNlbGxbZGF0YS1yb3c9XFxcIlwiICsgZGVzdGluYXRpb25Sb3cgKyBcIlxcXCJdW2RhdGEtY29sdW1uPVxcXCJcIiArIGRlc3RpbmF0aW9uQ29sdW1uICsgXCJcXFwiXVwiKTtcclxuICAgICAgICAgICAgaWYgKHNlY29uZGFyeURlc3RpbmF0aW9uLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRpbGVzVG9EcmFnLnB1c2godGlsZURhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2Vjb25kYXJ5RGVzdGluYXRpb24uYXBwZW5kQ2hpbGQoc2Vjb25kYXJ5VGlsZSk7XHJcbiAgICAgICAgICAgICAgICBwcmltYXJ5RGVzdGluYXRpb25DZWxsLmNsYXNzTGlzdC5yZW1vdmUoXCJvdmVyXCIpO1xyXG4gICAgICAgICAgICAgICAgcHJpbWFyeURlc3RpbmF0aW9uQ2VsbC5jbGFzc0xpc3QuYWRkKFwiZmlsbGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgKHNlY29uZGFyeVRpbGUgYXMgSFRNTEVsZW1lbnQpLmRhdGFzZXQucm93ID0gZGVzdGluYXRpb25Sb3c7XHJcbiAgICAgICAgICAgICAgICAoc2Vjb25kYXJ5VGlsZSBhcyBIVE1MRWxlbWVudCkuZGF0YXNldC5jb2x1bW4gPSBkZXN0aW5hdGlvbkNvbHVtbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHRpbGVzVG9EcmFnID0gW107XHJcbiAgICBjbGVhbkJlbmNoKCk7XHJcbiAgICByZXNldE1vZGlmaWVycygndGlsZScpO1xyXG59O1xyXG5cclxudmFyIHJlc2V0TW9kaWZpZXJzID0gZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xyXG4gICAgdmFyIGVsZW1lbnRzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLlwiICsgY2xhc3NOYW1lKSk7XHJcbiAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgbGV0IGh0bWxFbGVtZW50ID0gPEhUTUxFbGVtZW50PmVsZW1lbnQ7XHJcbiAgICAgICAgaHRtbEVsZW1lbnQuc3R5bGUub3BhY2l0eSA9IFwiXCI7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbnZhciBzZXRQb3NpdGlvbiA9IGZ1bmN0aW9uIChfYSkge1xyXG4gICAgdmFyIHRvcCA9IF9hLnRvcCwgbGVmdCA9IF9hLmxlZnQ7XHJcbiAgICAobWVudSBhcyBIVE1MRWxlbWVudCkuc3R5bGUubGVmdCA9IGxlZnQgKyBcInB4XCI7XHJcbiAgICAobWVudSBhcyBIVE1MRWxlbWVudCkuc3R5bGUudG9wID0gdG9wICsgXCJweFwiO1xyXG4gICAgdG9nZ2xlTWVudSgnc2hvdycpO1xyXG59O1xyXG5cclxudmFyIGNsZWFuQmVuY2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgYmVuY2ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2JlbmNoXCIpO1xyXG4gICAgLy8gQ3JlYXRlIGEgbGlzdCBvZiBhbGwgZW1wdHkgY2hpbGRyZW5cclxuICAgIHZhciBlbXB0eUNlbGxzID0gW107XHJcbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGJlbmNoLmNoaWxkcmVuLCBmdW5jdGlvbiAoY2VsbCwgaW5kZXgpIHtcclxuICAgICAgICBpZiAoY2VsbC5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICBlbXB0eUNlbGxzLnB1c2goY2VsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyBSZW1vdmUgZWFjaCBlbXB0eSBjaGlsZCBmcm9tIHRoZSBiZW5jaFxyXG4gICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChlbXB0eUNlbGxzLCBmdW5jdGlvbiAoY2VsbCwgaW5kZXgpIHtcclxuICAgICAgICBiZW5jaC5yZW1vdmVDaGlsZChjZWxsKTtcclxuICAgIH0pO1xyXG4gICAgLy8gcmVjYWxjdWxhdGUgcm93IGFuZCBjb2x1bW5zIG9mIGJlbmNoXHJcbiAgICBBcnJheS5mcm9tKGJlbmNoLmNoaWxkcmVuKS5mb3JFYWNoKGZ1bmN0aW9uIChiZW5jaENlbGwsIGluZGV4KSB7XHJcbiAgICAgICAgKGJlbmNoQ2VsbCBhcyBIVE1MRWxlbWVudCkuZGF0YXNldC5jb2x1bW4gPSBpbmRleC50b1N0cmluZygpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG52YXIgdG9nZ2xlTWVudSA9IGZ1bmN0aW9uIChjb21tYW5kKSB7XHJcbiAgICAobWVudSBhcyBIVE1MRWxlbWVudCkuc3R5bGUuZGlzcGxheSA9IGNvbW1hbmQgPT09IFwic2hvd1wiID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbiAgICBtZW51VmlzaWJsZSA9ICFtZW51VmlzaWJsZTtcclxufTtcclxuXHJcbmV4cG9ydCB7XHJcbiAgICBjbGVhbkJlbmNoLFxyXG4gICAgaGFuZGxlQ2xpY2ssXHJcbiAgICBoYW5kbGVEb3VibGVDbGljayxcclxuICAgIGhhbmRsZURyYWdFbmQsXHJcbiAgICBoYW5kbGVEcmFnRW50ZXIsXHJcbiAgICBoYW5kbGVEcmFnU3RhcnQsXHJcbiAgICBoYW5kbGVEcmFnTGVhdmUsXHJcbiAgICBoYW5kbGVEcmFnT3ZlcixcclxuICAgIGhhbmRsZU9uTW91c2VEb3duLFxyXG4gICAgaGFuZGxlRHJvcCxcclxuICAgIHJlc2V0TW9kaWZpZXJzLFxyXG4gICAgdG9nZ2xlTWVudSxcclxuICAgIG1lbnVWaXNpYmxlLFxyXG4gICAgb3B0aW9uc1xyXG59OyIsIi8qKioqKioqKioqKioqKioqKioqKipcclxuICpcclxuICogIEdlbmVyYWwgaGVscGVyIGZ1bmN0aW9uc1xyXG4gKlxyXG4gKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuY29uc3Qgcm93cyA9IDM1O1xyXG5jb25zdCBjb2x1bW5zID0gMzU7XHJcblxyXG5cclxudmFyIGlzSGFzaE1hcCA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICByZXR1cm4gKCFBcnJheS5pc0FycmF5KGl0ZW0pICYmIHR5cGVvZiAoaXRlbSkgPT09ICdvYmplY3QnKTtcclxufTtcclxuXHJcbnZhciBzYXZlVG9Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAoa2V5LCByYXdEYXRhKSB7XHJcbiAgICB2YXIgZGF0YSA9IHJhd0RhdGE7XHJcbiAgICBpZiAoaXNIYXNoTWFwKGRhdGEpKSB7XHJcbiAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG4gICAgfVxyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBkYXRhKTtcclxufTtcclxuXHJcbnZhciBnZXRUaWxlTmVpZ2hib3JzID0gZnVuY3Rpb24gKHRpbGUpIHtcclxuICAgIHZhciBuZWlnaGJvcnMgPSBbXTtcclxuICAgIHZhciB0aWxlUm93ID0gcGFyc2VJbnQodGlsZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXJvd1wiKSk7XHJcbiAgICB2YXIgdGlsZUNvbHVtbiA9IHBhcnNlSW50KHRpbGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1jb2x1bW5cIikpO1xyXG4gICAgdmFyIGJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNib2FyZFwiKTtcclxuICAgIC8vIEJhc2VkIG9uIHRoZSByb3cgYW5kIGNvbHVtbiB2YWx1ZXMsIGdldCB0aGUgYXBwcm9wcmlhdGUgbmVpZ2hib3JzXHJcbiAgICBpZiAodGlsZVJvdyA+IDApIHtcclxuICAgICAgICBuZWlnaGJvcnMucHVzaChib2FyZC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNlbGxbZGF0YS1yb3c9XFxcIlwiICsgKHRpbGVSb3cgLSAxKSArIFwiXFxcIl1bZGF0YS1jb2x1bW49XFxcIlwiICsgdGlsZUNvbHVtbiArIFwiXFxcIl1cIilbMF0pO1xyXG4gICAgfVxyXG4gICAgaWYgKHRpbGVSb3cgPCByb3dzIC0gMSkge1xyXG4gICAgICAgIG5laWdoYm9ycy5wdXNoKGJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2VsbFtkYXRhLXJvdz1cXFwiXCIgKyAodGlsZVJvdyArIDEpICsgXCJcXFwiXVtkYXRhLWNvbHVtbj1cXFwiXCIgKyB0aWxlQ29sdW1uICsgXCJcXFwiXVwiKVswXSk7XHJcbiAgICB9XHJcbiAgICBpZiAodGlsZUNvbHVtbiA+IDApIHtcclxuICAgICAgICBuZWlnaGJvcnMucHVzaChib2FyZC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNlbGxbZGF0YS1yb3c9XFxcIlwiICsgdGlsZVJvdyArIFwiXFxcIl1bZGF0YS1jb2x1bW49XFxcIlwiICsgKHRpbGVDb2x1bW4gLSAxKSArIFwiXFxcIl1cIilbMF0pO1xyXG4gICAgfVxyXG4gICAgaWYgKHRpbGVDb2x1bW4gPCBjb2x1bW5zIC0gMSkge1xyXG4gICAgICAgIG5laWdoYm9ycy5wdXNoKGJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2VsbFtkYXRhLXJvdz1cXFwiXCIgKyB0aWxlUm93ICsgXCJcXFwiXVtkYXRhLWNvbHVtbj1cXFwiXCIgKyAodGlsZUNvbHVtbiArIDEpICsgXCJcXFwiXVwiKVswXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmVpZ2hib3JzO1xyXG59O1xyXG5cclxudmFyIGlzVmFsaWRCb2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYm9hcmRcIik7XHJcbiAgICAvLyBNYWtlIHN1cmUgdGhlIGJlbmNoIGlzIGVtcHR5XHJcbiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiZW5jaFwiKS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLy8gVXNpbmcgYSBxdWV1ZSwgcHJvY2VzcyBlYWNoIHRpbGUgYW5kIG1ha2Ugc3VyZSB3ZSBjYW4gZ2V0IHRvIGV2ZXJ5IHRpbGVcclxuICAgIHZhciBwcm9jZXNzVGlsZXMgPSBbXTtcclxuICAgIHZhciBzZWVuVGlsZXMgPSBbXTtcclxuICAgIHByb2Nlc3NUaWxlcy5wdXNoKGJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGlsZVwiKVswXSk7XHJcbiAgICB3aGlsZSAocHJvY2Vzc1RpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICB2YXIgY3VyVGlsZSA9IHByb2Nlc3NUaWxlcy5wb3AoKTtcclxuICAgICAgICBpZiAoIXNlZW5UaWxlcy5pbmNsdWRlcyhjdXJUaWxlKSkge1xyXG4gICAgICAgICAgICBzZWVuVGlsZXMucHVzaChjdXJUaWxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcnMgb2YgdGhlIGN1cnJlbnQgdGlsZXMgYW5kIHB1c2ggdGhlbSBvbiBpZiB0aGV5IGhhdmVuJ3QgeWV0IGJlZW4gc2VlblxyXG4gICAgICAgIEFycmF5LmZyb20oZ2V0VGlsZU5laWdoYm9ycyhjdXJUaWxlKSkuZm9yRWFjaChmdW5jdGlvbiAobmVpZ2hib3IpIHtcclxuICAgICAgICAgICAgaWYgKG5laWdoYm9yLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGlsZFRpbGUgPSBuZWlnaGJvci5jaGlsZHJlblswXTtcclxuICAgICAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgbm90IHlldCBzZWVuIHRoZSBwcm9jZXNzZWQgdGlsZSwgcHVzaCBpdCBvbnRvIHRoZSBxdWV1ZVxyXG4gICAgICAgICAgICAgICAgaWYgKCFzZWVuVGlsZXMuaW5jbHVkZXMoY2hpbGRUaWxlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUaWxlcy5wdXNoKGNoaWxkVGlsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8vIElmIHdlIGhpdCBldmVyeSB0aWxlLCB0aGVuIHdlIGhhdmUgYSB2YWxpZCBib2FyZFxyXG4gICAgY29uc29sZS5sb2coXCJTZWVuIHRpbGVzIFwiICsgc2VlblRpbGVzLmxlbmd0aCk7XHJcbiAgICBjb25zb2xlLmxvZyhcIkFsbCB0aWxlcyBcIiArIGJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGlsZVwiKS5sZW5ndGgpO1xyXG4gICAgcmV0dXJuIHNlZW5UaWxlcy5sZW5ndGggPT09IGJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGlsZVwiKS5sZW5ndGg7XHJcbn07XHJcblxyXG52YXIgZ2V0QWxsV29yZHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgYWxsV29yZHMgPSBbXTtcclxuICAgIHZhciBib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYm9hcmRcIik7XHJcblxyXG4gICAgLy8gR2V0IGFsbCB3b3JkcyByb3cgd2lzZVxyXG4gICAgZm9yICh2YXIgciA9IDA7IHIgPCByb3dzOyByKyspIHtcclxuICAgICAgICB2YXIgY3VyV29yZCA9IFwiXCI7XHJcbiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBjb2x1bW5zOyBjKyspIHtcclxuICAgICAgICAgICAgdmFyIGN1ckNlbGwgPSBib2FyZC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNlbGxbZGF0YS1yb3c9XFxcIlwiICsgciArIFwiXFxcIl1bZGF0YS1jb2x1bW49XFxcIlwiICsgYyArIFwiXFxcIl1cIilbMF07XHJcbiAgICAgICAgICAgIGlmIChjdXJDZWxsLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGN1cldvcmQgKz0gY3VyQ2VsbC5jaGlsZHJlblswXS50ZXh0Q29udGVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJXb3JkLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbGxXb3Jkcy5wdXNoKGN1cldvcmQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY3VyV29yZCA9IFwiXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBHZXQgYWxsIGNvbHVtbiB3aXNlXHJcbiAgICBmb3IgKHZhciBjID0gMDsgYyA8IGNvbHVtbnM7IGMrKykge1xyXG4gICAgICAgIHZhciBjdXJXb3JkID0gXCJcIjtcclxuICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IHJvd3M7IHIrKykge1xyXG4gICAgICAgICAgICB2YXIgY3VyQ2VsbCA9IGJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2VsbFtkYXRhLXJvdz1cXFwiXCIgKyByICsgXCJcXFwiXVtkYXRhLWNvbHVtbj1cXFwiXCIgKyBjICsgXCJcXFwiXVwiKVswXTtcclxuICAgICAgICAgICAgaWYgKGN1ckNlbGwuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY3VyV29yZCArPSBjdXJDZWxsLmNoaWxkcmVuWzBdLnRleHRDb250ZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cldvcmQubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsbFdvcmRzLnB1c2goY3VyV29yZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjdXJXb3JkID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBhbGxXb3JkcztcclxufTtcclxuXHJcbnZhciBmaW5kRGlmZmVyZW5jZSA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICB2YXIgcmV0ID0gYS5zbGljZSgpO1xyXG4gICAgZm9yICh2YXIgX2kgPSAwLCBiXzEgPSBiOyBfaSA8IGJfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICB2YXIgdmFsID0gYl8xW19pXTtcclxuICAgICAgICB2YXIgaW5kZXggPSByZXQuaW5kZXhPZih2YWwpO1xyXG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIHJldC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXQ7XHJcbn1cclxuXHJcbmV4cG9ydCB7XHJcbiAgICBmaW5kRGlmZmVyZW5jZSxcclxuICAgIGdldEFsbFdvcmRzLFxyXG4gICAgZ2V0VGlsZU5laWdoYm9ycyxcclxuICAgIGlzVmFsaWRCb2FyZCxcclxuICAgIGNvbHVtbnMsXHJcbiAgICByb3dzLFxyXG59OyIsIi8qKlxyXG4gKiBIaWdoIGxldmVsIGJvYXJkIG1vZHVsZXMgY29udHJvbGxpbmcgdGhlIGNyZWF0aW9uIGFuZCBtYWludGFpbmVuY2Ugb2YgdGhlIGJvYXJkLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7XHJcbiAgICBoYW5kbGVEcmFnRW50ZXIsXHJcbiAgICBoYW5kbGVEcmFnRW5kLFxyXG4gICAgaGFuZGxlRHJhZ092ZXIsXHJcbiAgICBoYW5kbGVEcmFnTGVhdmUsXHJcbiAgICBoYW5kbGVPbk1vdXNlRG93bixcclxuICAgIGhhbmRsZURyb3AsXHJcbiAgICByZXNldE1vZGlmaWVycyxcclxuICAgIHRvZ2dsZU1lbnUsXHJcbiAgICBtZW51VmlzaWJsZSxcclxuICAgIG9wdGlvbnMsXHJcbn0gZnJvbSAnLi9ldmVudHMnO1xyXG5pbXBvcnQgeyBjb2x1bW5zLCByb3dzIH0gZnJvbSAnLi9oZWxwZXJzJztcclxuXHJcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1lbnVcIik7XHJcblxyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgcmVzZXRNb2RpZmllcnMoJ3RpbGUnKTtcclxufSwgb3B0aW9ucyk7XHJcblxyXG52YXIgc2VsZWN0QWxsVGlsZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2JvYXJkXCIpO1xyXG4gICAgQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudGlsZScpKS5mb3JFYWNoKGZ1bmN0aW9uICh0aWxlKSB7XHJcbiAgICAgICAgaWYgKGJvYXJkLmNvbnRhaW5zKHRpbGUpKSB7XHJcbiAgICAgICAgICAgIHRpbGUuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbnZhciBwb3B1bGF0ZUJvYXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcclxuICAgIGZvciAodmFyIHIgPSAwOyByIDwgcm93czsgcisrKSB7XHJcbiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBjb2x1bW5zOyBjKyspIHtcclxuICAgICAgICAgICAgYm9hcmQuaW5uZXJIVE1MICs9IFwiPGRpdiBjbGFzcz1cXFwiY2VsbFxcXCIgZGF0YS1yb3c9XCIgKyByICsgXCIgZGF0YS1jb2x1bW49XCIgKyBjICsgXCI+PC9kaXY+XCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gQXR0YWNoIHRoZSBsaXN0ZW5lcnMgdG8gdGhlIGdyaWQgY2VsbHNcclxuICAgIEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5jZWxsXCIpKS5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XHJcbiAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwib25tb3VzZWRvd25cIiwgaGFuZGxlT25Nb3VzZURvd24sIG9wdGlvbnMpO1xyXG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbnRlclwiLCBoYW5kbGVEcmFnRW50ZXIsIG9wdGlvbnMpO1xyXG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCBoYW5kbGVEcmFnTGVhdmUsIG9wdGlvbnMpO1xyXG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIGhhbmRsZURyYWdPdmVyLCBvcHRpb25zKTtcclxuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIGhhbmRsZURyYWdFbmQsIG9wdGlvbnMpO1xyXG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgaGFuZGxlRHJvcCwgb3B0aW9ucyk7XHJcbiAgICB9KTtcclxuICAgIGNlbnRlckJvYXJkKCk7XHJcbn07XHJcblxyXG52YXIgY2VudGVyQm9hcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkNlbnRlcmluZ1wiKTtcclxuICAgIHZhciBib2FyZFZpZXdwb3J0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZC12aWV3cG9ydFwiKTtcclxuICAgIHZhciBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XHJcbiAgICB2YXIgc2Nyb2xsUG9zaXRpb25YID0gYm9hcmQub2Zmc2V0TGVmdCArIChib2FyZC5vZmZzZXRXaWR0aCAvIDIpO1xyXG4gICAgdmFyIHNjcm9sbFBvc2l0aW9uWSA9IGJvYXJkLm9mZnNldFRvcCArIChib2FyZC5vZmZzZXRIZWlnaHQgLyAzKTtcclxuICAgIGJvYXJkVmlld3BvcnQuc2Nyb2xsTGVmdCA9IHNjcm9sbFBvc2l0aW9uWDtcclxuICAgIGJvYXJkVmlld3BvcnQuc2Nyb2xsVG9wID0gc2Nyb2xsUG9zaXRpb25ZO1xyXG59O1xyXG5cclxudmFyIGluaXRfYm9hcmQgPSBmdW5jdGlvbiAoKSB7Ly8gSW5pdGlhbGx5IGhpZGUgZXZlcnl0aGluZ1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnYW1lcGxheVwiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWUtb3ZlclwiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcblxyXG4gICAgLy8gV2FybiB1c2VyIGJlZm9yZSBsZWF2aW5nXHJcbiAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gbGVhdmUsIHRoaXMgd2lsbCBjbGVhciB5b3VyIGJvYXJkPyc7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyX2lkXCIpO1xyXG5cclxuICAgIC8vIEV4ZWN1dGUgYSBmdW5jdGlvbiB3aGVuIHRoZSB1c2VyIHJlbGVhc2VzIGEga2V5IG9uIHRoZSBrZXlib2FyZFxyXG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIC8vIE51bWJlciAxMyBpcyB0aGUgXCJFbnRlclwiIGtleSBvbiB0aGUga2V5Ym9hcmRcclxuICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSBkZWZhdWx0IGFjdGlvbiwgaWYgbmVlZGVkXHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIC8vIFRyaWdnZXIgdGhlIGJ1dHRvbiBlbGVtZW50IHdpdGggYSBjbGlja1xyXG4gICAgICAgICAgICAkKFwiI3BsYXllcl9pZF9zdWJtaXRcIikuY2xpY2soKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKG1lbnVWaXNpYmxlKVxyXG4gICAgICAgICAgICB0b2dnbGVNZW51KFwiaGlkZVwiKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5pbml0X2JvYXJkKCk7XHJcbnBvcHVsYXRlQm9hcmQoKTtcclxuXHJcbmV4cG9ydCB7XHJcbiAgICBzZWxlY3RBbGxUaWxlcyxcclxuICAgIHJvd3MsXHJcbiAgICBjb2x1bW5zXHJcbn07Il0sInNvdXJjZVJvb3QiOiIifQ==